{% extends 'anime/base.html' %}
{% load static %}
{% block style %}
    #more {display: none;}

    dl, ol, ul {
    margin-top: 0;
    margin-bottom: 0;
    }
    .breadcrumb {
    margin-bottom: 0;
    background-color: inherit ;
    padding: 0;
    }

    .chap_img {
    width: 40px ;
    height: 55px ;
    margin-right: 15px;
    margin-top: 10px;
    border-radius: 5px;
    }

    a:hover {
    color: #0056b3;
    text-decoration: none;
    }

    .hover:hover {
    opacity: 1!important;
    background-color:#EEE;
    }

    #new_option_form {
    width: 100%;
    height: 100%;
    z-index :1000;
    margin-left: 20%;
    }

    #new_option,#new_option_input {
    width: 50%;
    margin-top: 0%;
    margin-left: 14%;
    z-index: 1001;
    }

    /* STAR RATE STYLE */
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: arial;
    }

    .star-rating form {
    display: none;
    }

    .star-rating .thanks-msg {
    display: none;
    font-size: 20px;
    margin: 40px auto;
    color: #4caf50;
    background-color: rgba(76, 175, 80, 0.1411764705882353);
    padding: 8px 20px;
    border-left: 3px solid #4caf50;
    border-radius: 20px;
    }

    .star-rating input {
    display: none;
    }

    .star-rating {
    margin: 50px 0% 0 0%;
    display: table;
    width: 100%;
    float: left!important;

    }
    .star-rating label {
    padding: 10px;
    float: right;
    font-size: 44px;
    color: #eee;
    }
    .star-rating input:not(:checked) ~ label:hover,
    .star-rating input:not(:checked) ~ label:hover ~ label {
    color: #ffc107;
    }
    .star-rating input:checked ~ label {
    color: #ffc107;
    }
    .star-rating form .rating-reaction:before {
    width: 100%;
    float: left;
    color: #ffc107;
    }
    .star-rating #rating-1:checked ~ form .rating-reaction:before {
    content: "I hate it";
    }
    .star-rating #rating-2:checked ~ form .rating-reaction:before {
    content: "I don't like it";
    }
    .star-rating #rating-3:checked ~ form .rating-reaction:before {
    content: "It is good";
    }
    .star-rating #rating-4:checked ~ form .rating-reaction:before {
    content: "I like it";
    }
    .star-rating #rating-5:checked ~ form .rating-reaction:before {
    content: "I love it";
    }
    .star-rating input:checked ~ form {
    border-top: 1px solid #ddd;
    width: 100%;
    padding-top: 15px;
    margin-top: 15px;
    display: inline-block;
    }
    .star-rating form .rating-reaction {
    font-size: 24px;
    float: left;
    text-transform: capitalize;
    }
    .star-rating form .submit-rating {
    border: none;
    outline: none;
    background: #795548;
    color: #ffc107;
    font-size: 18px;
    border-radius: 4px;
    padding: 5px 15px;
    cursor: pointer;
    float: right;
    }
    form .submit-rating:hover {
    background-color: #333;
    }


{% endblock style %}

{% block content %}

    <div class="container">
        <div class="card">
            <div class="card-header">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'main:index' %}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'main:manga:index' %}">Manga List</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ manga.title }}</li>
                    </ol>
                </nav>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <img src="/media/poster.webp" class="mb-2">
                        <form id="add_to_list" data-manga="{{ manga.id }}" class="d-flex">
                            <select class="form-select" aria-label="Default select" id="lista" name="list_name" data-lists="{{ lists }}" >
                                {% for list in user.list_set.all %}
                                    <option id="{{ list.id }}"
                                            value="{{ list.id }}">{{ list.name }}</option>
                                {% endfor %}
                                <option>new list</option>
                            </select>
                            <button id='add_list_button' type="submit" class="btn btn-info px-3">
                                {% if in_main_list %}
                                      -
                                {% else %}
                                      +
                                {% endif %}
                            </button>
                        </form>
                    </div>
                    <div class="col-md-8">
                        <h3 class="card-title">{{ manga.name }}</h3>
                        <p class="card-text">{{ manga.description|slice:":250" }} <span id="dots">...</span><span
                                id="more"> {{ manga.description|slice:"250:" }}</span>
                            <a href="#" onclick="myFunction()" id="myBtn">Read more</a>
                        </p>
                        <div class="mb-3">
                            <h5 class="d-inline">Genres: </h5>
                            {% for g in manga.genres_as_list %}
                                <a href="#" class="btn-info rounded-pill p-1">{{ g }}</a>
                            {% endfor %}
                        </div>
                        <a href="#" class="btn btn-primary">Start Read</a>
                        <button type="submit" id="follow-btn"
                                class="btn {% if in_fav %}btn-danger{% else %}btn-primary{% endif %}">
                            {% if in_fav %}
                                Unfollow
                            {% else %}
                                Follow
                            {% endif %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <div class="container">
            <h2 class="mt-3">Chapters</h2>
            <ul class="list-group">
                {% for chapter in manga.chapter_set.all %}
                    <a href="{% url 'main:manga:chapter:details' manga.id chapter.id %}" class="mb-2">
                        <li class="list-group-item d-flex  hover">
                            <img src="/media/poster.webp" class="chap_img">
                            <div>
                                <div class="d-block  fs-3">{{ chapter.manga.name }}</div>
                                <span class="d-block p-1 bg-primary rounded-pill text-white">Chapter {{ chapter.chapter_number }} <span
                                        class="bg-danger pr-2 pl-2 rounded-pill text-white">New</span></span>
                            </div>
                        </li>
                        <span></span>
                    </a>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="reviews">
        <div class="container">
            <h2>Reviews</h2>
            <div class="star-rating text-left mb-5">
                <div class="thanks-msg text-left">Thanks for your feedback !!!</div>
                <div class="star-input float-start">
                    <input type="radio" name="rating" id="rating-5" onclick="setRate(5)">
                    <label for="rating-5" class="fas fa-star"></label>
                    <input type="radio" name="rating" id="rating-4" onclick="setRate(4)">
                    <label for="rating-4" class="fas fa-star"></label>
                    <input type="radio" name="rating" id="rating-3" onclick="setRate(3)">
                    <label for="rating-3" class="fas fa-star"></label>
                    <input type="radio" name="rating" id="rating-2" onclick="setRate(2)">
                    <label for="rating-2" class="fas fa-star"></label>
                    <input type="radio" name="rating" id="rating-1" onclick="setRate(1)">
                    <label for="rating-1" class="fas fa-star"></label>

                    <!-- Rating Submit Form -->
                    <form method="POST" id="review">
                        {% csrf_token %}
                        <input type="hidden" name="manga_id" value="{{ manga.id }}">
                        {{ form.content }}
                        <span class="rating-reaction"></span>
                        <button type="submit" class="submit-rating align-bottom">Submit</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="container all_review">
            {% for review in manga.review_set.all %}
                <div class="card mb-3">
                    <div class="card-header">
                        {{ review.user.username }}
                        {% if request.user == review.user %}
                            <button class="btn btn-danger float-end">Delete</button>
                        {% endif %}
                    </div>
                    <div class="card-body">
                        <span>{{ review.user.username }} gives it {{ review.given_rate }} Star{{ review.given_rate|pluralize }}</span>
                        <p class="card-text">{{ review.content }}</p>
                    </div>
                </div>

            {% endfor %}
        </div>
    </div>
{% endblock content %}

{% block script %}
    <script type="text/javascript" src="{% static 'assets/manga/manga_details.js' %}"></script>
{% endblock %}